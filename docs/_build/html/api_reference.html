<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Reference - DFT Documentation</title>
    <link rel="stylesheet" href="../assets/style.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>API Reference</h1>
            <p>Droplet-Film Theory Development Project</p>
            <nav>
                <a href="../index.html">Home</a>
                <a href="documentation.html">Documentation</a>
                <a href="installation_guide.html">Installation</a>
                <a href="usage_examples.html">Usage</a>
                <a href="api_reference.html">API Reference</a>
                <a href="troubleshooting.html">Troubleshooting</a>
            </nav>
        </header>
        
        <main>
            <div class="sidebar">
                <h3>Contents</h3>
                <ul>
                    <li><a href="#introduction">Introduction</a></li>
                    <li><a href="#installation">Installation</a></li>
                    <li><a href="#quick-start">Quick Start</a></li>
                    <li><a href="#data-format">Data Format</a></li>
                    <li><a href="#running">Running DFT Development</a></li>
                    <li><a href="#troubleshooting">Troubleshooting</a></li>
                    <li><a href="#examples">Examples</a></li>
                    <li><a href="#performance">Performance</a></li>
                    <li><a href="#how-to">How-to Guides</a></li>
                    <li><a href="#tutorials">Tutorial Scripts</a></li>
                </ul>
            </div>
            
            <div class="content">
<h1 class="main-header">API Reference</h1>
<p class="paragraph">Droplet-Film Theory Development Project</p>
<p class="paragraph">Technical Documentation</p>
<p class="paragraph">Overview</p>
<p class="paragraph">This document provides comprehensive technical documentation for all classes, methods, and parameters in the DFT Development project. The API is designed to be both powerful and user-friendly, supporting both research and industrial applications.</p>
<p class="paragraph">The project follows object-oriented design principles with clear separation of concerns between physics modeling, data management, and machine learning components.</p>
<p class="paragraph">Core Classes and Modules</p>
<p class="paragraph">The project consists of several key modules:</p>
<li class="bullet-point">dft_model.py: Core physics model implementation</li>
<li class="bullet-point">utils.py: Data management and utility functions</li>
<li class="bullet-point">Individual Jupyter notebooks for different approaches</li>
<p class="paragraph">DFT Class - Core Physics Model</p>
<p class="paragraph">The DFT class implements the Droplet-Film Theory physics model for predicting critical flow rates in gas wells.</p>
<p class="paragraph">Class Definition</p>
<div class="code-snippet">class DFT:</div>
<p class="paragraph">"""</p>
<p class="paragraph">Droplet-Film Theory model for predicting critical flow rates in gas wells.</p>
<p class="paragraph">This class implements a physics-informed machine learning approach that combines</p>
<p class="paragraph">fundamental fluid dynamics principles with data-driven optimization to predict</p>
<p class="paragraph">when gas wells will experience liquid loading.</p>
<p class="paragraph">"""</p>
<p class="paragraph">Constructor</p>
<p class="paragraph">__init__(self, seed=42, feature_tol=1.0, dev_tol=1e-3, multiple_dev_policy="max")</p>
<p class="paragraph">Parameters:</p>
<li class="bullet-point">seed (int): Random seed for reproducibility. Default: 42</li>
<li class="bullet-point">feature_tol (float): Feature distance threshold for matching. Default: 1.0</li>
<li class="bullet-point">dev_tol (float): Deviation tolerance for angle matching. Default: 1e-3</li>
<li class="bullet-point">multiple_dev_policy (str): Policy for handling multiple matches. Options: "max", "min", "mean", "median". Default: "max"</li>
<p class="paragraph">Attributes:</p>
<li class="bullet-point">seed: Random seed value</li>
<li class="bullet-point">feature_tol: Feature tolerance threshold</li>
<li class="bullet-point">dev_tol: Deviation tolerance threshold</li>
<li class="bullet-point">multiple_dev_policy: Multiple match handling policy</li>
<li class="bullet-point">opt_params: Optimized parameters (set after fitting)</li>
<li class="bullet-point">n_train: Number of training samples (set after fitting)</li>
<p class="paragraph">Methods</p>
<p class="paragraph">fit(self, X, y)</p>
<p class="paragraph">Train the DFT model on provided data.</p>
<p class="paragraph">Parameters:</p>
<li class="bullet-point">X (np.ndarray): Input features array with shape (n_samples, 10)</li>
<li class="bullet-point">y (np.ndarray): Target values array with shape (n_samples,)</li>
<p class="paragraph">Returns:</p>
<li class="bullet-point">self: Fitted model instance</li>
<p class="paragraph">Features (in order):</p>
<h2 class="section">1. Dia: Well diameter (meters)</h2>
<h2 class="section">2. Dev(deg): Well deviation angle (degrees)</h2>
<h2 class="section">3. Area (m2): Cross-sectional area (square meters)</h2>
<h2 class="section">4. z: Elevation change (meters)</h2>
<h2 class="section">5. GasDens: Gas density (kg/m³)</h2>
<h2 class="section">6. LiquidDens: Liquid density (kg/m³)</h2>
<h2 class="section">7. g (m/s2): Gravitational acceleration (m/s²)</h2>
<h2 class="section">8. P/T: Pressure/Temperature ratio (Pa/K)</h2>
<h2 class="section">9. friction_factor: Friction factor (dimensionless)</h2>
<h2 class="section">10. critical_film_thickness: Critical film thickness (meters)</h2>
<p class="paragraph">Implementation Details:</p>
<li class="bullet-point">Uses Powell optimization method from scipy.optimize</li>
<li class="bullet-point">Optimizes 5 global parameters (p1-p5) plus alpha values for each training sample</li>
<li class="bullet-point">Bounds: p1-p5 unbounded, alpha in [0, 1]</li>
<li class="bullet-point">Maximum iterations: 5000, maximum function calls: 10000</li>
<p class="paragraph">predict(self, X, dev_train=None, alpha_strategy='enhanced_dev_based')</p>
<p class="paragraph">Make predictions on new data.</p>
<p class="paragraph">Parameters:</p>
<li class="bullet-point">X (np.ndarray): New input data with shape (n_samples, 10)</li>
<li class="bullet-point">dev_train (np.ndarray, optional): Training deviation angles for alpha assignment</li>
<li class="bullet-point">alpha_strategy (str): Alpha assignment strategy. Must be 'enhanced_dev_based'</li>
<p class="paragraph">Returns:</p>
<li class="bullet-point">np.ndarray: Predicted values with shape (n_samples,)</li>
<p class="paragraph">Alpha Assignment Strategy:</p>
<p class="paragraph">The method uses a sophisticated three-tier strategy based on well deviation angle:</p>
<h2 class="section">1. Dev < 10°: Regular deviation-based matching</h2>
<li class="bullet-point">Find training samples within dev_tol</li>
<li class="bullet-point">Apply multiple_dev_policy if multiple matches found</li>
<li class="bullet-point">Use mean training alpha if no matches</li>
<h2 class="section">2. 10° ≤ Dev < 20°: Minimum alpha strategy</h2>
<li class="bullet-point">Find training samples within dev_tol</li>
<li class="bullet-point">Use minimum alpha among matches</li>
<li class="bullet-point">Use mean training alpha if no matches</li>
<h2 class="section">3. Dev ≥ 20°: Full-feature matching</h2>
<li class="bullet-point">Compute Euclidean distance to all training samples</li>
<li class="bullet-point">Use closest sample's alpha if distance < feature_tol</li>
<li class="bullet-point">Use mean training alpha otherwise</li>
<p class="paragraph">_eq(self, params, X)</p>
<p class="paragraph">Compute predicted values using the physics equation.</p>
<p class="paragraph">Parameters:</p>
<li class="bullet-point">params (np.ndarray): Model parameters (5 global + alpha values)</li>
<li class="bullet-point">X (np.ndarray): Input features with shape (n_samples, 10)</li>
<p class="paragraph">Returns:</p>
<li class="bullet-point">np.ndarray: Predicted values with shape (n_samples,)</li>
<p class="paragraph">Physics Equation:</p>
<p class="paragraph">Qcr = p1 × √(|term1 × α + (1-α) × term2| × (1/z) × (P/T))</p>
<p class="paragraph">Where:</p>
<li class="bullet-point">term1 = (2 × g × Dia × (1 - 3×(Dia/h_cr) + 3×(Dia/h_cr)²) × (ρ_l - ρ_g) × cos(Dev) / (f × ρ_g)) × p4</li>
<li class="bullet-point">term2 = |sin(p5 × Dev)|^p3 × ((ρ_l - ρ_g)^p2 / ρ_g²)</li>
<p class="paragraph">_loss(self, params)</p>
<p class="paragraph">Compute loss function for optimization.</p>
<p class="paragraph">Parameters:</p>
<li class="bullet-point">params (np.ndarray): Model parameters</li>
<p class="paragraph">Returns:</p>
<li class="bullet-point">float: Mean squared error loss</li>
<p class="paragraph">ChiefBldr Class - Data Management</p>
<p class="paragraph">The ChiefBldr class handles dataset loading, preprocessing, model training, and evaluation.</p>
<p class="paragraph">Class Definition</p>
<div class="code-snippet">class ChiefBldr:</div>
<p class="paragraph">"""</p>
<p class="paragraph">Data management and model training utility class.</p>
<p class="paragraph">This class provides comprehensive functionality for loading datasets,</p>
<p class="paragraph">splitting data, training models, and evaluating performance.</p>
<p class="paragraph">"""</p>
<p class="paragraph">Constructor</p>
<p class="paragraph">__init__(self, path, seed=42, drop_cols=None, includ_cols=None, test_size=0.20, scale=False)</p>
<p class="paragraph">Parameters:</p>
<li class="bullet-point">path (str): Path to dataset file (CSV format)</li>
<li class="bullet-point">seed (int): Random seed for reproducibility. Default: 42</li>
<li class="bullet-point">drop_cols (List[str], optional): Columns to exclude from analysis</li>
<li class="bullet-point">includ_cols (List[str], optional): Columns to include in analysis</li>
<li class="bullet-point">test_size (float): Fraction of data for test set. Default: 0.20</li>
<li class="bullet-point">scale (bool): Whether to scale features. Default: False</li>
<p class="paragraph">Attributes (set after initialization):</p>
<li class="bullet-point">X (np.ndarray): Full feature matrix with shape (n_samples, n_features)</li>
<li class="bullet-point">y (np.ndarray): Target values with shape (n_samples,)</li>
<li class="bullet-point">X_train (np.ndarray): Training features</li>
<li class="bullet-point">X_test (np.ndarray): Test features</li>
<li class="bullet-point">y_train (np.ndarray): Training targets</li>
<li class="bullet-point">y_test (np.ndarray): Test targets</li>
<li class="bullet-point">feature_names (List[str]): List of feature column names</li>
<li class="bullet-point">scaler (StandardScaler): Fitted scaler (if scale=True)</li>
<p class="paragraph">Methods</p>
<p class="paragraph">evolv_model(self, build_model, hparam_grid, k_folds=5)</p>
<p class="paragraph">Train model with hyperparameter optimization.</p>
<p class="paragraph">Parameters:</p>
<li class="bullet-point">build_model (Callable): Function that creates model from hyperparameters</li>
<li class="bullet-point">hparam_grid (Dict): Dictionary of hyperparameter lists to try</li>
<li class="bullet-point">k_folds (int): Number of cross-validation folds. Default: 5</li>
<p class="paragraph">Returns:</p>
<li class="bullet-point">Any: Best trained model</li>
<p class="paragraph">Implementation Details:</p>
<li class="bullet-point">Performs grid search over all hyperparameter combinations</li>
<li class="bullet-point">Uses k-fold cross-validation for each combination</li>
<li class="bullet-point">Selects best model based on validation performance</li>
<li class="bullet-point">Stores training and test predictions</li>
<li class="bullet-point">Computes performance metrics (MSE, R²)</li>
<p class="paragraph">Performance Metrics (set after training):</p>
<li class="bullet-point">loss (float): Mean squared error on training data</li>
<li class="bullet-point">r2_score (float): R-squared correlation coefficient</li>
<li class="bullet-point">y_train_pred (np.ndarray): Training predictions</li>
<li class="bullet-point">y_test_pred (np.ndarray): Test predictions</li>
<p class="paragraph">QLatticeWrapper Class - Symbolic Regression</p>
<p class="paragraph">The QLatticeWrapper class provides interface to Feyn QLattice for automated symbolic regression.</p>
<p class="paragraph">Class Definition</p>
<div class="code-snippet">class QLatticeWrapper:</div>
<p class="paragraph">"""</p>
<p class="paragraph">Wrapper class for Feyn QLattice symbolic regression.</p>
<p class="paragraph">This class provides a scikit-learn compatible interface to QLattice,</p>
<p class="paragraph">enabling automated discovery of mathematical expressions from data.</p>
<p class="paragraph">"""</p>
<p class="paragraph">Constructor</p>
<p class="paragraph">__init__(self, feature_tags, output_tag="Qcr", seed=42, max_complexity=10, n_epochs=10, criterion="bic")</p>
<p class="paragraph">Parameters:</p>
<li class="bullet-point">feature_tags (List[str]): List of feature names</li>
<li class="bullet-point">output_tag (str): Target variable name. Default: "Qcr"</li>
<li class="bullet-point">seed (int): Random seed for reproducibility. Default: 42</li>
<li class="bullet-point">max_complexity (int): Maximum model complexity. Default: 10</li>
<li class="bullet-point">n_epochs (int): Number of training epochs. Default: 10</li>
<li class="bullet-point">criterion (str): Model selection criterion. Options: "bic", "aic", "r2". Default: "bic"</li>
<p class="paragraph">Attributes:</p>
<li class="bullet-point">seed: Random seed value</li>
<li class="bullet-point">feature_tags: List of feature names</li>
<li class="bullet-point">output_tag: Target variable name</li>
<li class="bullet-point">max_complexity: Maximum model complexity</li>
<li class="bullet-point">n_epochs: Number of training epochs</li>
<li class="bullet-point">criterion: Model selection criterion</li>
<li class="bullet-point">ql: QLattice connection object</li>
<li class="bullet-point">opt_model: Optimized model (set after fitting)</li>
<li class="bullet-point">y_pred: Predictions (set after fitting)</li>
<p class="paragraph">Methods</p>
<p class="paragraph">fit(self, X, y)</p>
<p class="paragraph">Train the QLattice model.</p>
<p class="paragraph">Parameters:</p>
<li class="bullet-point">X (np.ndarray): Input features with shape (n_samples, n_features)</li>
<li class="bullet-point">y (np.ndarray): Target values with shape (n_samples,)</li>
<p class="paragraph">Returns:</p>
<li class="bullet-point">self: Fitted model instance</li>
<p class="paragraph">Implementation Details:</p>
<li class="bullet-point">Converts NumPy arrays to pandas DataFrames</li>
<li class="bullet-point">Connects to QLattice service</li>
<li class="bullet-point">Trains model with specified parameters</li>
<li class="bullet-point">Selects best model based on criterion</li>
<p class="paragraph">predict(self, X)</p>
<p class="paragraph">Make predictions on new data.</p>
<p class="paragraph">Parameters:</p>
<li class="bullet-point">X (np.ndarray): Input features with shape (n_samples, n_features)</li>
<p class="paragraph">Returns:</p>
<li class="bullet-point">np.ndarray: Predicted values with shape (n_samples,)</li>
<p class="paragraph">express(self)</p>
<p class="paragraph">Get symbolic expression of the trained model.</p>
<p class="paragraph">Returns:</p>
<li class="bullet-point">sympy.Expr: Symbolic expression in SymPy format</li>
<p class="paragraph">Data Format Requirements</p>
<p class="paragraph">Input CSV files must contain exactly these columns:</p>
<h2 class="section">1. Dia (float): Well diameter in meters</h2>
<h2 class="section">2. Dev(deg) (float): Well deviation angle in degrees</h2>
<h2 class="section">3. Area (m2) (float): Cross-sectional area in square meters</h2>
<h2 class="section">4. z (float): Elevation change in meters</h2>
<h2 class="section">5. GasDens (float): Gas density in kg/m³</h2>
<h2 class="section">6. LiquidDens (float): Liquid density in kg/m³</h2>
<h2 class="section">7. g (m/s2) (float): Gravitational acceleration in m/s²</h2>
<h2 class="section">8. P/T (float): Pressure/Temperature ratio in Pa/K</h2>
<h2 class="section">9. friction_factor (float): Friction factor (dimensionless)</h2>
<h2 class="section">10. critical_film_thickness (float): Critical film thickness in meters</h2>
<p class="paragraph">Data Validation</p>
<p class="paragraph">The ChiefBldr class automatically validates data format and handles common issues:</p>
<li class="bullet-point">Missing value detection and handling</li>
<li class="bullet-point">Data type validation</li>
<li class="bullet-point">Column name verification</li>
<li class="bullet-point">Range checking for physical parameters</li>
<p class="paragraph">Error Handling</p>
<p class="paragraph">The API includes comprehensive error handling for:</p>
<li class="bullet-point">Invalid input data formats</li>
<li class="bullet-point">Missing required columns</li>
<li class="bullet-point">Optimization convergence failures</li>
<li class="bullet-point">Memory allocation issues</li>
<li class="bullet-point">Network connectivity problems (QLattice)</li>
<p class="paragraph">Performance Considerations</p>
<p class="paragraph">Memory Usage:</p>
<li class="bullet-point">Scales linearly with dataset size</li>
<li class="bullet-point">DFT model: O(n_samples × n_features)</li>
<li class="bullet-point">ChiefBldr: O(n_samples × n_features)</li>
<li class="bullet-point">QLattice: O(n_samples × n_features × complexity)</li>
<p class="paragraph">Training Time:</p>
<li class="bullet-point">DFT model: O(n_samples × n_iterations)</li>
<li class="bullet-point">ChiefBldr: O(n_combinations × k_folds × n_samples)</li>
<li class="bullet-point">QLattice: O(n_epochs × complexity × n_samples)</li>
<p class="paragraph">Scalability:</p>
<li class="bullet-point">Use data sampling for large datasets during development</li>
<li class="bullet-point">Consider parallel processing for hyperparameter optimization</li>
<li class="bullet-point">Monitor memory usage with large feature spaces</li>
<p class="paragraph">Integration Capabilities</p>
<p class="paragraph">The API is designed for seamless integration with:</p>
<li class="bullet-point">Scikit-learn: Compatible fit/predict interface</li>
<li class="bullet-point">Pandas: DataFrame input/output support</li>
<li class="bullet-point">NumPy: Array-based operations</li>
<li class="bullet-point">Matplotlib/Seaborn: Visualization integration</li>
<li class="bullet-point">Jupyter: Interactive development support</li>
<p class="paragraph">Type Hints</p>
<p class="paragraph">All functions include comprehensive type hints for better IDE support and code documentation:</p>
<pre><code>
<span class="code-line">from typing import Optional, List, Callable, Dict, Any, Union</span>
<span class="code-line">import numpy as np</span>
<span class="code-line">import pandas as pd</span>
</code></pre>
<p class="paragraph">Development and Testing</p>
<p class="paragraph">The codebase includes:</p>
<li class="bullet-point">Comprehensive docstrings for all functions</li>
<li class="bullet-point">Type hints for better code clarity</li>
<li class="bullet-point">Unit test framework support</li>
<li class="bullet-point">Error message localization</li>
<li class="bullet-point">Logging capabilities for debugging</li>
<p class="paragraph">Future API Extensions</p>
<p class="paragraph">Planned additions include:</p>
<li class="bullet-point">Additional physics models (drift-flux, mechanistic)</li>
<li class="bullet-point">Ensemble methods for improved accuracy</li>
<li class="bullet-point">Real-time prediction capabilities</li>
<li class="bullet-point">REST API endpoints for web integration</li>
<li class="bullet-point">Cloud deployment support</li>
<li class="bullet-point">GPU acceleration for large datasets</li>
<p class="paragraph">Migration Guide</p>
<p class="paragraph">For users upgrading from previous versions:</p>
<h2 class="section">1. Update import statements if module structure changed</h2>
<h2 class="section">2. Check parameter names for any modifications</h2>
<h2 class="section">3. Verify data format compatibility</h2>
<h2 class="section">4. Test with sample data before full deployment</h2>
<h2 class="section">5. Review performance metrics for any changes</h2>
<p class="paragraph">Deprecation Notices</p>
<li class="bullet-point">No deprecated features in current version</li>
<li class="bullet-point">Future deprecations will be announced with 6-month notice</li>
<li class="bullet-point">Migration guides will be provided for all breaking changes</li>
<p class="paragraph">Support and Resources</p>
<li class="bullet-point">GitHub repository: Primary source for code and issues</li>
<li class="bullet-point">Documentation: Comprehensive guides and examples</li>
<li class="bullet-point">Community forums: User discussions and support</li>
<li class="bullet-point">Issue tracker: Bug reports and feature requests</li>
<li class="bullet-point">Research papers: Scientific background and validation</li>
<p class="paragraph">This API reference provides complete technical documentation for the DFT Development project. For additional examples and tutorials, refer to the Usage Examples guide and individual Jupyter notebooks.</p>
            </div>
        </main>
        
        <footer>
            <p>Generated on 2025-10-15 20:28:33</p>
            <p>Droplet-Film Theory Development Project</p>
        </footer>
    </div>
</body>
</html>